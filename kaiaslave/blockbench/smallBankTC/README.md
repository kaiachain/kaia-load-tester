# smallBankTC

## Test Case Description

`smallBankTC` is based on the SmallBank benchmark in
[BlockBench](https://github.com/ooibc88/blockbench).

For your reference, the original description of SmallBank benchmark in the
SIGMOD paper is like the below:
> Unlike YCSB which does not consider transactions, Smallbank is a popular
> benchmark for OLTP workload. It consists of three tables and four basic
> procedures simulating basic operations on bank accounts. Smallbank is
> implemented as a smart contract which simply transfers money from one account
> to another.

`smallBankTC` tests basic bank operations using the `SmallBank` smart contract.
The test Go functions in `smallBankTC.go` and their corresponding function in
the `SmallBank` smart contract are described in the table below.

| Function | Description |
| -------- | ----------- |
| `Almagate` | Call the `almagate` function in the `SmallBank` contract, which moves the entire balance in one's checking account to the other's saving account |
| `GetBalance` | Call the `getBalance` function in the `SmallBank` contract, which returns the balance sum of one's checking and saving accounts |
| `UpdateBalance` | Call the `updateBalance` function in the `SmallBank` contract, which adds a given value to one's checking account |
| `UpdateSaving` | Call the `updateSaving` function in the `SmallBank` contract, which adds a given value to one's saving account |
| `SendPayment` | Call the `sendPayment` function in the `SmallBank` contract, which pays (or moves) a requested value from one's checking account to the other's |
| `WriteCheck` | Call the `writeCheck` function in the `SmallBank` contract, which tries to mimic the action of issuing a check (however, the implementation logic looks weird) |
| `Run` | Randomly invoke one test function among `Almagate`, `GetBalance`, `UpdateBalance`, `UpdateSaving`, `SendPayment`, and `WriteCheck` |


## How to Set the Maximum Number of Users

The environment variable `SMALLBANK_MAX_NUM_USERS` can be used to change the
maximum number of users, whose default value is 100000.  For example,
```shell
$ SMALLBANK_MAX_NUM_USERS=200000 ./klayslave ...
```

Note that the number of users can affect the performance of this test case
because the smart contract's state could be increased depending on the number
of different users.


## Source Files

This directory has the following source files.

- `SmallBank.sol`: `SmallBank` contract file written in solidity
   - Origin: https://github.com/ooibc88/blockbench/blob/master/benchmark/contracts/ethereum/smallbank.sol
   - Updated the solidity version in the pragma statement to v0.4.24
   - Modified function signatures to suppress solc warnings
- `SmallBank.go`: Go binding code generated by `abigen` using `go generate`
- `smallBankTC.go`: initialization and test functions implementation
   - Took the overall idea from [BlockBench's SmallBank benchmark code](https://github.com/ooibc88/blockbench/tree/master/src/macro/smallbank)

## References

- [BlockBench github repository](https://github.com/ooibc88/blockbench)
- [BLOCKBENCH: A Framework for Analyzing Private Blockchains](https://dl.acm.org/citation.cfm?id=3064033), published in SIGMOD '17
