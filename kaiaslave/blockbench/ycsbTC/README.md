# ycsbTC

## Test Case Description

`ycsbTC` is based on the YCSB (KVStore) benchmark in
[BlockBench](https://github.com/ooibc88/blockbench) and is actually a
simplified version of the original YCSB benchmark.

For your reference, the original description of YCSB in the SIGMOD paper is
like the below:
> YCSB is a simple smart contract which functions as a key-value storage.  It
> preloads each store with a number of records, and supports requests with
> different ratios of read and write operations. YCSB is widely used for
> evaluating NoSQL databases.

`ycsbTC` tests a key-value storage, where both key and value are string, by
calling `set` and `get` functions defined in the `KVstore` smart contract
(`kvstore.sol`).  It provides the following functions for testing:

| Function | Description |
| -------- | ----------- |
| `Set` | Call the `set` function in the `KVstore` contract with a randomly chosen but a range-limited key and a random value |
| `Get` | Call the `get` function in the `KVstore` contract with a randomly chosen key, which has the same range as does the key used for the `set` function |
| `Run` | Randomly invoke one test function between `Set` and `Get` |


## How to Set the Maximum Number of Keys

The environment variable `YCSB_MAX_NUM_KEYS` can be used to change the maximum
number of keys, whose default value is 100000.  For example,
```shell
$ YCSB_MAX_NUM_KEYS=200000 ./klayslave ...
```

Note that the number of keys can affect the performance of this test case
because the smart contract's state could be increased depending on the number
of different keys.


## Source Files

This directory has the following source files.

- `kvstore.sol`: `KVstore` contract file written in solidity
   - Origin: https://github.com/ooibc88/blockbench/blob/master/benchmark/contracts/ethereum/kvstore.sol
   - Updated the solidity version in the pragma statement to v0.4.24
   - Modified function signatures to suppress solc warnings
- `kvstore.go`: Go binding code generated by `abigen` using `go generate`
- `ycsbTC.go`: initialization and test functions implementation
   - Took the overall idea from [the original YCSB benchmark in BlockBench](https://github.com/ooibc88/blockbench/tree/master/src/macro/kvstore)


## References

- [BlockBench github repository](https://github.com/ooibc88/blockbench)
- [BLOCKBENCH: A Framework for Analyzing Private Blockchains](https://dl.acm.org/citation.cfm?id=3064033), published in SIGMOD '17
